<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BJJ Prep - Preparação para Competições</title>
    <meta name="description" content="Aplicativo para preparação de competições de jiu-jitsu brasileiro">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .app {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Login Screen */
        .login-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-card {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
            text-align: center;
        }

        .logo {
            font-size: 48px;
            margin-bottom: 20px;
        }

        .login-header h1 {
            font-size: 28px;
            margin-bottom: 8px;
            color: #333;
        }

        .login-header p {
            color: #666;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn-primary {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            margin-bottom: 20px;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
        }

        .btn-link {
            background: none;
            border: none;
            color: #667eea;
            cursor: pointer;
            text-decoration: underline;
            font-size: 14px;
        }

        .hidden {
            display: none !important;
        }

        /* Dashboard */
        .dashboard {
            display: none;
            flex: 1;
            background: #f8fafc;
        }

        .dashboard.active {
            display: flex;
            flex-direction: column;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .welcome-text {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .subtitle {
            opacity: 0.9;
            margin-bottom: 20px;
        }

        .competition-card {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .competition-card h3 {
            font-size: 18px;
            margin-bottom: 10px;
        }

        .competition-card h4 {
            font-size: 16px;
            margin-bottom: 15px;
            opacity: 0.9;
        }

        .competition-card p {
            margin-bottom: 5px;
            opacity: 0.9;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 14px;
        }

        .actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .action-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: transform 0.2s;
        }

        .action-card:hover {
            transform: translateY(-2px);
        }

        .action-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .tips-section {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .tips-section h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .tip-item {
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }

        .tip-item:last-child {
            border-bottom: none;
        }

        /* Add Competition */
        .form-section {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .form-section h2 {
            color: #333;
            margin-bottom: 20px;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 16px;
        }

        .btn-analyze {
            background: linear-gradient(135deg, #10ac84 0%, #00d2d3 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
        }

        .result-card {
            background: linear-gradient(135deg, #10ac84 0%, #00d2d3 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
        }

        /* AI Chat */
        .chat-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            height: 500px;
            display: flex;
            flex-direction: column;
        }

        .chat-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px 15px 0 0;
            text-align: center;
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .message {
            margin-bottom: 15px;
            display: flex;
            align-items: flex-start;
        }

        .message.user {
            justify-content: flex-end;
        }

        .message-content {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 15px;
            background: #f1f3f4;
        }

        .message.user .message-content {
            background: #667eea;
            color: white;
        }

        .chat-input {
            padding: 20px;
            border-top: 1px solid #eee;
            display: flex;
            gap: 10px;
        }

        .chat-input input {
            flex: 1;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 25px;
            outline: none;
        }

        .btn-send {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
        }

        /* Profile */
        .profile-section {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .profile-info {
            margin-bottom: 15px;
        }

        .profile-info strong {
            color: #333;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
        }

        /* Bottom Navigation */
        .bottom-nav {
            background: white;
            padding: 10px 0;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-around;
        }

        .nav-btn {
            background: none;
            border: none;
            padding: 10px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #666;
            font-size: 12px;
        }

        .nav-btn.active {
            color: #667eea;
        }

        .nav-icon {
            font-size: 20px;
            margin-bottom: 4px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .content {
                padding: 15px;
            }
            
            .login-card {
                padding: 30px 20px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .actions-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="app">
        <!-- Login Screen -->
        <div id="loginScreen" class="login-container">
            <div class="login-card">
                <div class="login-header">
                    <div class="logo">🥋</div>
                    <h1 id="loginTitle">Entrar</h1>
                    <p id="loginSubtitle">Acesse sua conta BJJ Prep</p>
                </div>

                <form id="loginForm">
                    <div id="nameGroup" class="form-group hidden">
                        <label>Nome Completo</label>
                        <input type="text" id="nameInput" placeholder="João Silva">
                    </div>

                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="emailInput" placeholder="seu@email.com" required>
                    </div>

                    <div class="form-group">
                        <label>Senha</label>
                        <input type="password" id="passwordInput" placeholder="••••••••" required>
                    </div>

                    <button type="submit" class="btn-primary" id="submitBtn">Entrar</button>
                </form>

                <button type="button" class="btn-link" id="toggleBtn">
                    Não tem conta? Criar uma agora
                </button>
            </div>
        </div>

        <!-- Dashboard -->
        <div id="dashboard" class="dashboard">
            <div class="header">
                <h1 class="welcome-text">Olá, <span id="userName">Atleta</span>! 👋</h1>
                <p class="subtitle">Bem-vindo ao BJJ Prep</p>
            </div>

            <div class="content">
                <!-- Home Tab -->
                <div id="homeTab" class="tab-content active">
                    <div class="competition-card">
                        <h3>🏆 Próxima Competição</h3>
                        <h4>Campeonato Brasileiro CBJJ 2024</h4>
                        <p>📅 15 de Dezembro, 2024</p>
                        <p>📍 Ginásio do Ibirapuera, São Paulo</p>
                        <p>⏰ 45 dias restantes</p>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number">82.5kg</div>
                            <div class="stat-label">Peso atual</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">12</div>
                            <div class="stat-label">Dias de treino</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">3</div>
                            <div class="stat-label">Competições 2024</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">Amanhã</div>
                            <div class="stat-label">Próximo treino</div>
                        </div>
                    </div>

                    <div class="actions-grid">
                        <div class="action-card" onclick="showTab('addTab')">
                            <div class="action-icon">🏆</div>
                            <h4>Adicionar Competição</h4>
                            <p>Cole o link da competição</p>
                        </div>
                        <div class="action-card" onclick="showTab('chatTab')">
                            <div class="action-icon">🤖</div>
                            <h4>Conversar com AI</h4>
                            <p>Dicas personalizadas</p>
                        </div>
                    </div>

                    <div class="tips-section">
                        <h3>💡 Dicas do AI Coach</h3>
                        <div class="tip-item">
                            💧 Mantenha-se hidratado! Beba pelo menos 35ml por kg de peso corporal diariamente.
                        </div>
                        <div class="tip-item">
                            🥋 Pratique escapes de posições ruins - isso pode salvar sua competição!
                        </div>
                    </div>
                </div>

                <!-- Add Competition Tab -->
                <div id="addTab" class="tab-content">
                    <div class="form-section">
                        <h2>Adicionar Competição</h2>
                        <div class="input-group">
                            <input type="url" id="competitionUrl" placeholder="Cole o link da competição CBJJ/IBJJF aqui...">
                        </div>
                        <button class="btn-analyze" onclick="analyzeCompetition()">Analisar Competição</button>
                        <div id="competitionResult"></div>
                    </div>
                </div>

                <!-- AI Chat Tab -->
                <div id="chatTab" class="tab-content">
                    <div class="chat-container">
                        <div class="chat-header">
                            <h3>🤖 AI Coach</h3>
                            <p>Especialista em jiu-jitsu brasileiro</p>
                        </div>
                        <div class="chat-messages" id="chatMessages">
                            <div class="message">
                                <div class="message-content">
                                    Olá! Sou seu AI Coach especializado em jiu-jitsu. Como posso ajudar você hoje?
                                </div>
                            </div>
                        </div>
                        <div class="chat-input">
                            <input type="text" id="messageInput" placeholder="Digite sua pergunta..." onkeypress="handleEnter(event)">
                            <button class="btn-send" onclick="sendMessage()">Enviar</button>
                        </div>
                    </div>
                </div>

                <!-- Profile Tab -->
                <div id="profileTab" class="tab-content">
                    <div class="profile-section">
                        <h2>Perfil do Usuário</h2>
                        <div class="profile-info">
                            <p><strong>Nome:</strong> <span id="profileName">Usuário</span></p>
                        </div>
                        <div class="profile-info">
                            <p><strong>Email:</strong> <span id="profileEmail">usuario@email.com</span></p>
                        </div>
                        <div class="profile-info">
                            <p><strong>Peso atual:</strong> 82.5 kg</p>
                        </div>
                        <div class="profile-info">
                            <p><strong>Faixa:</strong> Azul</p>
                        </div>
                        <button class="btn-danger" onclick="logout()">Sair</button>
                    </div>
                </div>
            </div>

            <!-- Bottom Navigation -->
            <div class="bottom-nav">
                <button class="nav-btn active" onclick="showTab('homeTab', this)">
                    <div class="nav-icon">🏠</div>
                    <span>Home</span>
                </button>
                <button class="nav-btn" onclick="showTab('addTab', this)">
                    <div class="nav-icon">➕</div>
                    <span>Adicionar</span>
                </button>
                <button class="nav-btn" onclick="showTab('chatTab', this)">
                    <div class="nav-icon">🤖</div>
                    <span>AI Coach</span>
                </button>
                <button class="nav-btn" onclick="showTab('profileTab', this)">
                    <div class="nav-icon">👤</div>
                    <span>Perfil</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        let isRegisterMode = false;
        let currentUser = null;

        // Initialize app when page loads
        window.addEventListener('load', function() {
            // Check if user is already logged in
            const savedUser = localStorage.getItem('bjj_user');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showDashboard();
            } else {
                document.getElementById('loginScreen').style.display = 'flex';
                document.getElementById('dashboard').style.display = 'none';
            }

            // Setup event listeners
            setupEventListeners();
        });

        function setupEventListeners() {
            // Toggle between login and register
            document.getElementById('toggleBtn').onclick = function() {
                isRegisterMode = !isRegisterMode;
                
                const nameGroup = document.getElementById('nameGroup');
                const loginTitle = document.getElementById('loginTitle');
                const loginSubtitle = document.getElementById('loginSubtitle');
                const submitBtn = document.getElementById('submitBtn');
                const toggleBtn = document.getElementById('toggleBtn');
                
                if (isRegisterMode) {
                    nameGroup.classList.remove('hidden');
                    loginTitle.textContent = 'Criar Conta';
                    loginSubtitle.textContent = 'Junte-se ao BJJ Prep';
                    submitBtn.textContent = 'Criar Conta';
                    toggleBtn.textContent = 'Já tem conta? Fazer login';
                } else {
                    nameGroup.classList.add('hidden');
                    loginTitle.textContent = 'Entrar';
                    loginSubtitle.textContent = 'Acesse sua conta BJJ Prep';
                    submitBtn.textContent = 'Entrar';
                    toggleBtn.textContent = 'Não tem conta? Criar uma agora';
                }
            };

            // Handle form submission
            document.getElementById('loginForm').onsubmit = function(e) {
                e.preventDefault();
                
                const name = document.getElementById('nameInput').value || 'Usuário';
                const email = document.getElementById('emailInput').value;
                const password = document.getElementById('passwordInput').value;
                
                if (!email || !password) {
                    alert('Por favor, preencha todos os campos obrigatórios.');
                    return;
                }
                
                if (password.length < 6) {
                    alert('A senha deve ter pelo menos 6 caracteres.');
                    return;
                }
                
                currentUser = {
                    id: Date.now(),
                    name: name,
                    email: email,
                    weight: 82.5,
                    belt: 'Azul'
                };
                
                localStorage.setItem('bjj_user', JSON.stringify(currentUser));
                showDashboard();
            };
        }

        function showDashboard() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('dashboard').style.display = 'flex';
            document.getElementById('dashboard').classList.add('active');
            
            // Update user info
            const firstName = currentUser.name.split(' ')[0];
            document.getElementById('userName').textContent = firstName;
            document.getElementById('profileName').textContent = currentUser.name;
            document.getElementById('profileEmail').textContent = currentUser.email;
            
            // Show home tab by default
            showTab('homeTab');
        }

        function showTab(tabId, buttonElement) {
            // Hide all tabs
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Show selected tab
            document.getElementById(tabId).classList.add('active');
            
            // Update navigation buttons
            if (buttonElement) {
                const navBtns = document.querySelectorAll('.nav-btn');
                navBtns.forEach(btn => btn.classList.remove('active'));
                buttonElement.classList.add('active');
            }
        }

        function logout() {
            localStorage.removeItem('bjj_user');
            currentUser = null;
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('dashboard').classList.remove('active');
            
            // Reset form
            document.getElementById('loginForm').reset();
            
            // Reset to login mode
            if (isRegisterMode) {
                document.getElementById('toggleBtn').click();
            }
        }

        // AI Coach functionality
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message
            addMessage(message, true);
            input.value = '';
            
            // Generate AI response
            setTimeout(() => {
                const response = generateAIResponse(message);
                addMessage(response, false);
            }, 1000);
        }

        function addMessage(text, isUser) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message' + (isUser ? ' user' : '');
            
            messageDiv.innerHTML = `
                <div class="message-content">${text}</div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function generateAIResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            if (lowerMessage.includes('treino') || lowerMessage.includes('treinar')) {
                return 'Para treinos eficazes: 1) Aquecimento de 10-15 min, 2) Técnica por 30 min, 3) Sparring por 20-30 min, 4) Alongamento final. Mantenha consistência de 3-4x por semana.';
            } else if (lowerMessage.includes('dieta') || lowerMessage.includes('alimentação')) {
                return 'Para competições: 1) Mantenha hidratação adequada, 2) Carboidratos complexos 2-3h antes, 3) Evite alimentos pesados no dia, 4) Suplementação com BCAA se necessário. Consulte um nutricionista esportivo.';
            } else if (lowerMessage.includes('peso') || lowerMessage.includes('cortar')) {
                return 'Corte de peso seguro: 1) Planeje com 4-6 semanas de antecedência, 2) Reduza 0.5-1kg por semana, 3) Mantenha hidratação, 4) Evite cortes drásticos. Sua saúde vem primeiro!';
            } else if (lowerMessage.includes('competição') || lowerMessage.includes('campeonato')) {
                return 'Preparação mental: 1) Visualize suas técnicas, 2) Pratique respiração profunda, 3) Chegue cedo no local, 4) Tenha um plano de jogo. Confie no seu treino!';
            } else {
                return 'Ótima pergunta! Como especialista em jiu-jitsu, recomendo focar em: técnica consistente, condicionamento físico adequado e mentalidade positiva. Tem alguma área específica que gostaria de melhorar?';
            }
        }

        function handleEnter(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        // Competition analysis functionality with real web scraping
        async function analyzeCompetition() {
            const url = document.getElementById('competitionUrl').value.trim();
            const resultDiv = document.getElementById('competitionResult');
            
            if (!url) {
                alert('Por favor, insira o link da competição.');
                return;
            }
            
            if (!url.includes('cbjj.com') && !url.includes('ibjjf.com')) {
                alert('Por favor, insira um link válido da CBJJ ou IBJJF.');
                return;
            }
            
            // Show loading
            resultDiv.innerHTML = '<p style="text-align: center; padding: 20px;">🔄 Analisando competição...</p>';
            
            try {
                // Real web scraping using a proxy service
                const competitionData = await scrapeCompetitionData(url);
                
                if (competitionData) {
                    resultDiv.innerHTML = `
                        <div class="result-card">
                            <h3>🏆 ${competitionData.name}</h3>
                            <p><strong>📅 Data:</strong> ${competitionData.date}</p>
                            <p><strong>📍 Local:</strong> ${competitionData.location}</p>
                            <p><strong>💰 Inscrições:</strong> ${competitionData.price}</p>
                            <p><strong>⏰ Prazo:</strong> ${competitionData.deadline}</p>
                            <hr style="margin: 15px 0; border: 1px solid rgba(255,255,255,0.3);">
                            <h4>📈 Plano de Preparação</h4>
                            <p><strong>🎯 Tempo restante:</strong> ${competitionData.daysLeft} dias</p>
                            <p><strong>⚖️ Categoria sugerida:</strong> Meio-Pesado (82.3kg)</p>
                            <p><strong>🏃‍♂️ Treinos recomendados:</strong> 4x por semana</p>
                            <p><strong>📉 Meta de peso:</strong> Manter atual (82.5kg)</p>
                            <button onclick="closeResult()" style="background: rgba(255,255,255,0.2); border: 1px solid white; color: white; padding: 8px 16px; border-radius: 5px; margin-top: 10px; cursor: pointer;">Fechar</button>
                        </div>
                    `;
                } else {
                    throw new Error('Não foi possível extrair dados da competição');
                }
                
                // Clear the input
                document.getElementById('competitionUrl').value = '';
                
            } catch (error) {
                console.error('Erro ao analisar competição:', error);
                resultDiv.innerHTML = `
                    <div style="background: #e74c3c; color: white; padding: 20px; border-radius: 15px; margin-top: 20px;">
                        <h3>❌ Erro na Análise</h3>
                        <p>Não foi possível extrair dados desta competição. Isso pode acontecer devido a:</p>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li>Link inválido ou página não encontrada</li>
                            <li>Estrutura da página foi alterada</li>
                            <li>Problemas de conectividade</li>
                        </ul>
                        <p><strong>Tente:</strong></p>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li>Verificar se o link está correto</li>
                            <li>Usar um link mais recente</li>
                            <li>Tentar novamente em alguns minutos</li>
                        </ul>
                        <button onclick="closeResult()" style="background: rgba(255,255,255,0.2); border: 1px solid white; color: white; padding: 8px 16px; border-radius: 5px; margin-top: 10px; cursor: pointer;">Fechar</button>
                    </div>
                `;
            }
        }

        // Real web scraping function
        async function scrapeCompetitionData(url) {
            try {
                // Use CORS proxy to bypass CORS restrictions
                const proxyUrl = 'https://api.allorigins.win/get?url=' + encodeURIComponent(url);
                
                const response = await fetch(proxyUrl);
                const data = await response.json();
                
                if (!data.contents) {
                    throw new Error('Não foi possível acessar a página');
                }
                
                // Parse HTML content
                const parser = new DOMParser();
                const doc = parser.parseFromString(data.contents, 'text/html');
                
                // Extract data based on domain
                if (url.includes('cbjj.com')) {
                    return extractCBJJData(doc, url);
                } else if (url.includes('ibjjf.com')) {
                    return extractIBJJFData(doc, url);
                }
                
                return null;
                
            } catch (error) {
                console.error('Erro no scraping:', error);
                return null;
            }
        }

        // Extract data from CBJJ pages
        function extractCBJJData(doc, url) {
            try {
                // Extract title
                const titleElement = doc.querySelector('title');
                let name = titleElement ? titleElement.textContent.trim() : 'Campeonato CBJJ';
                name = name.replace(' | IBJJF', '').trim();
                
                // Extract date
                let date = 'Data não encontrada';
                const dateRegex = /\d{1,2}\s*-\s*\d{1,2}\s*de\s*\w+\s*de\s*\d{4}/;
                const bodyText = doc.body.textContent;
                const dateMatch = bodyText.match(dateRegex);
                if (dateMatch) {
                    date = dateMatch[0].trim();
                }
                
                // Extract location
                let location = 'Local não encontrado';
                const locationRegex = /Arena|Ginásio|Centro|Pavilhão/;
                const locationMatch = bodyText.match(locationRegex);
                if (locationMatch) {
                    // Try to get more context around the match
                    const index = bodyText.indexOf(locationMatch[0]);
                    const context = bodyText.substring(index, index + 100);
                    const lines = context.split('\n');
                    location = lines[0].trim();
                }
                
                // Extract price
                let price = 'Preço não encontrado';
                const priceRegex = /R\$\s*\d+[,.]?\d*/;
                const priceMatch = bodyText.match(priceRegex);
                if (priceMatch) {
                    price = priceMatch[0].trim();
                }
                
                // Extract deadline
                let deadline = 'Prazo não encontrado';
                const deadlineRegex = /até\s*\d{1,2}\s*de\s*\w+\s*de\s*\d{4}/;
                const deadlineMatch = bodyText.match(deadlineRegex);
                if (deadlineMatch) {
                    deadline = deadlineMatch[0].trim();
                }
                
                // Calculate days left
                const daysLeft = calculateDaysLeft(date);
                
                return {
                    name: name,
                    date: date,
                    location: location,
                    price: price,
                    deadline: deadline,
                    daysLeft: daysLeft,
                    source: 'CBJJ'
                };
                
            } catch (error) {
                console.error('Erro ao extrair dados da CBJJ:', error);
                return null;
            }
        }

        // Extract data from IBJJF pages
        function extractIBJJFData(doc, url) {
            try {
                // Extract title
                const titleElement = doc.querySelector('title');
                let name = titleElement ? titleElement.textContent.trim() : 'Campeonato IBJJF';
                name = name.replace(' | IBJJF', '').trim();
                
                // Extract date - IBJJF format: "September 28th, 2025"
                let date = 'Data não encontrada';
                const bodyText = doc.body.textContent;
                
                // Try multiple date patterns for IBJJF
                const datePatterns = [
                    /\w+\s+\d{1,2}(st|nd|rd|th),\s+\d{4}/,  // September 28th, 2025
                    /\w+\s+\d{1,2}-\d{1,2},\s+\d{4}/,       // August 30-31, 2025
                    /\d{1,2}-\d{1,2}\s+\w+\s+\d{4}/,        // 30-31 August 2025
                    /\w+\s+\d{1,2},\s+\d{4}/                // August 29, 2025
                ];
                
                for (const pattern of datePatterns) {
                    const dateMatch = bodyText.match(pattern);
                    if (dateMatch) {
                        date = dateMatch[0].trim();
                        break;
                    }
                }
                
                // Extract location - IBJJF format: "Mission Concepcion Sports Park"
                let location = 'Local não encontrado';
                const locationPatterns = [
                    /Location[\s\S]*?([A-Z][A-Za-z\s]+(?:Park|Center|Arena|Convention|Sports|Complex|Gym))/,
                    /Location[\s\S]*?([A-Z][A-Za-z\s]+)(?=\n|\d)/,
                    /(?:Arena|Convention|Center|Pavilhão|Ginásio|Sports|Park|Complex)[\s\w]*/
                ];
                
                for (const pattern of locationPatterns) {
                    const locationMatch = bodyText.match(pattern);
                    if (locationMatch) {
                        location = locationMatch[1] ? locationMatch[1].trim() : locationMatch[0].trim();
                        // Clean up location text
                        location = location.replace(/Location\s*/i, '').trim();
                        if (location.length > 5) break;
                    }
                }
                
                // Extract price - IBJJF format: "$134.00 (USD)"
                let price = 'Preço não encontrado';
                const pricePatterns = [
                    /\$\d+\.\d{2}\s*\(USD\)/,               // $134.00 (USD)
                    /\$\d+\.\d{2}/,                         // $134.00
                    /USD\s*\$?\d+\.\d{2}/                   // USD $134.00
                ];
                
                for (const pattern of pricePatterns) {
                    const priceMatch = bodyText.match(pattern);
                    if (priceMatch) {
                        price = priceMatch[0].trim();
                        if (!price.includes('USD')) {
                            price += ' (USD)';
                        }
                        break;
                    }
                }
                
                // Extract deadline - IBJJF format: "until August 29th, 2025"
                let deadline = 'Prazo não encontrado';
                const deadlinePatterns = [
                    // Pattern 1: "until August 29th, 2025"
                    /(until\s+\w+\s+\d{1,2}(?:st|nd|rd|th),\s+\d{4})/i,
                    // Pattern 2: "Registration deadline: September 19th, 2025"
                    /Registration\s+deadline[\s\S]*?(\w+\s+\d{1,2}(?:st|nd|rd|th),\s+\d{4})/i,
                    // Pattern 3: Any deadline followed by date
                    /deadline[\s\S]*?(\w+\s+\d{1,2}(?:st|nd|rd|th),\s+\d{4})/i,
                    // Pattern 4: Just the date format for IBJJF
                    /(\w+\s+\d{1,2}(?:st|nd|rd|th),\s+\d{4})/,
                    // Pattern 5: Standard format without ordinals
                    /(until\s+\w+\s+\d{1,2},\s+\d{4})/i
                ];
                
                for (const pattern of deadlinePatterns) {
                    const deadlineMatch = bodyText.match(pattern);
                    if (deadlineMatch) {
                        let extractedDeadline = deadlineMatch[1] ? deadlineMatch[1].trim() : deadlineMatch[0].trim();
                        
                        // Clean up the deadline text
                        extractedDeadline = extractedDeadline.replace(/until\s+/i, '').trim();
                        extractedDeadline = extractedDeadline.replace(/Registration\s+deadline[\s\S]*?/i, '').trim();
                        extractedDeadline = extractedDeadline.replace(/deadline[\s\S]*?/i, '').trim();
                        
                        // Format for Portuguese
                        if (extractedDeadline.length > 5 && extractedDeadline.includes('2025')) {
                            deadline = 'Até ' + extractedDeadline;
                            break;
                        }
                    }
                }
                
                // Fallback: try to find any date in 2025 as deadline
                if (deadline === 'Prazo não encontrado') {
                    const fallbackPattern = /(\w+\s+\d{1,2}(?:st|nd|rd|th)?,\s+2025)/;
                    const fallbackMatch = bodyText.match(fallbackPattern);
                    if (fallbackMatch) {
                        deadline = 'Até ' + fallbackMatch[1].trim();
                    }
                }
                
                // Calculate days left
                const daysLeft = calculateDaysLeft(date);
                
                return {
                    name: name,
                    date: date,
                    location: location,
                    price: price,
                    deadline: deadline,
                    daysLeft: daysLeft,
                    source: 'IBJJF'
                };
                
            } catch (error) {
                console.error('Erro ao extrair dados da IBJJF:', error);
                return null;
            }
        }

        // Calculate days left until competition
        function calculateDaysLeft(dateText) {
            try {
                if (!dateText || dateText === 'Data não encontrada') {
                    return 0;
                }
                
                const today = new Date();
                let competitionDate;
                
                // Parse different date formats
                if (dateText.includes('de') && dateText.includes('2025')) {
                    // CBJJ format: "19 - 20 de setembro de 2025"
                    const monthMap = {
                        'janeiro': 0, 'fevereiro': 1, 'março': 2, 'abril': 3,
                        'maio': 4, 'junho': 5, 'julho': 6, 'agosto': 7,
                        'setembro': 8, 'outubro': 9, 'novembro': 10, 'dezembro': 11
                    };
                    
                    const parts = dateText.split(' ');
                    const day = parseInt(parts[0]);
                    const monthName = parts[3];
                    const year = parseInt(parts[5]);
                    const month = monthMap[monthName];
                    
                    competitionDate = new Date(year, month, day);
                } else if (dateText.includes('th,') || dateText.includes('st,') || dateText.includes('nd,') || dateText.includes('rd,')) {
                    // IBJJF format: "September 28th, 2025"
                    const cleanDate = dateText.replace(/(\d+)(st|nd|rd|th)/, '$1');
                    competitionDate = new Date(cleanDate);
                } else {
                    // Try standard date parsing
                    competitionDate = new Date(dateText);
                }
                
                // Check if date is valid
                if (isNaN(competitionDate.getTime())) {
                    return 0;
                }
                
                // Calculate difference in days
                const timeDiff = competitionDate.getTime() - today.getTime();
                const daysDiff = Math.ceil(timeDiff / (1000 * 3600 * 24));
                
                return daysDiff > 0 ? daysDiff : 0;
                
            } catch (error) {
                console.error('Erro ao calcular dias restantes:', error);
                return 0;
            }
        }

        function closeResult() {
            document.getElementById('competitionResult').innerHTML = '';
        }
    </script>
</body>
</html>

